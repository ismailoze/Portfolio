<div class="p-4 sm:p-6">
  <div
    class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6 sm:mb-8"
  >
    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white">
      {{ "nav.skills" | translate }}
    </h2>
    <button
      (click)="openForm()"
      class="btn btn--primary w-full sm:w-auto text-sm sm:text-base"
    >
      {{ "common.create" | translate }}
    </button>
  </div>

  @if (loading()) {
  <app-loading-spinner></app-loading-spinner>
  } @if (error() && !loading()) {
  <app-error-message [message]="error()!"></app-error-message>
  } @if (!loading() && !error()) { @if (skills().length === 0) {
  <div class="text-center py-12">
    <p class="text-gray-600 dark:text-gray-400 text-lg mb-4">
      Henüz yetenek eklenmemiş.
    </p>
    <button (click)="openForm()" class="btn btn--primary">
      {{ "common.create" | translate }} {{ "nav.skills" | translate }}
    </button>
  </div>
  } @else {
  <!-- Mobile: Card View, Desktop: Table View -->
  <div class="block sm:hidden space-y-3">
    @for (skill of skills(); track skill.id) {
    <div class="card p-4">
      <div class="flex items-start gap-3 mb-3">
        <div
          class="flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-slate-700/50 border border-gray-200 dark:border-slate-600 flex-shrink-0"
        >
          <app-skill-icon
            [iconName]="skill.icon"
            [size]="24"
            color="currentColor"
          ></app-skill-icon>
        </div>
        <div class="flex-1 min-w-0">
          <h3 class="font-semibold text-gray-900 dark:text-white mb-1">
            {{ skill.name }}
          </h3>
          <p class="text-xs text-gray-600 dark:text-gray-400">
            {{ skill.category }}
          </p>
          <div
            class="flex items-center gap-3 mt-2 text-xs text-gray-500 dark:text-gray-400"
          >
            <span>Seviye: {{ skill.level }}%</span>
            <span>•</span>
            <span>Sıra: {{ skill.displayOrder }}</span>
          </div>
        </div>
      </div>
      <div
        class="flex gap-2 pt-3 border-t border-gray-200 dark:border-slate-700"
      >
        <button
          (click)="openForm(skill)"
          class="btn btn--outline btn--sm flex-1 text-xs"
        >
          {{ "common.edit" | translate }}
        </button>
        <button
          (click)="deleteSkill(skill)"
          class="btn btn--outline btn--sm text-red-600 dark:text-red-400 flex-1 text-xs"
        >
          {{ "common.delete" | translate }}
        </button>
      </div>
    </div>
    }
  </div>

  <!-- Desktop: Table View -->
  <div class="hidden sm:block overflow-x-auto">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-b border-gray-200 dark:border-slate-700">
          <th
            class="text-left p-3 sm:p-4 text-sm sm:text-base text-gray-700 dark:text-gray-300"
          >
            Icon
          </th>
          <th
            class="text-left p-3 sm:p-4 text-sm sm:text-base text-gray-700 dark:text-gray-300"
          >
            İsim
          </th>
          <th
            class="text-left p-3 sm:p-4 text-sm sm:text-base text-gray-700 dark:text-gray-300"
          >
            Kategori
          </th>
          <th
            class="text-left p-3 sm:p-4 text-sm sm:text-base text-gray-700 dark:text-gray-300"
          >
            Seviye
          </th>
          <th
            class="text-left p-3 sm:p-4 text-sm sm:text-base text-gray-700 dark:text-gray-300"
          >
            Sıra
          </th>
          <th
            class="text-right p-3 sm:p-4 text-sm sm:text-base text-gray-700 dark:text-gray-300"
          >
            İşlemler
          </th>
        </tr>
      </thead>
      <tbody>
        @for (skill of skills(); track skill.id) {
        <tr
          class="border-b border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50"
        >
          <td class="p-3 sm:p-4">
            <div
              class="flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-lg bg-gray-100 dark:bg-slate-700/50 border border-gray-200 dark:border-slate-600"
            >
              <app-skill-icon
                [iconName]="skill.icon"
                [size]="24"
                color="currentColor"
              ></app-skill-icon>
            </div>
          </td>
          <td
            class="p-3 sm:p-4 text-sm sm:text-base font-medium text-gray-900 dark:text-white"
          >
            {{ skill.name }}
          </td>
          <td
            class="p-3 sm:p-4 text-sm sm:text-base text-gray-600 dark:text-gray-400"
          >
            {{ skill.category }}
          </td>
          <td
            class="p-3 sm:p-4 text-sm sm:text-base text-gray-600 dark:text-gray-400"
          >
            {{ skill.level }}%
          </td>
          <td
            class="p-3 sm:p-4 text-sm sm:text-base text-gray-600 dark:text-gray-400"
          >
            {{ skill.displayOrder }}
          </td>
          <td class="p-3 sm:p-4 text-right">
            <div class="flex gap-2 justify-end">
              <button
                (click)="openForm(skill)"
                class="btn btn--outline btn--sm text-xs sm:text-sm"
              >
                {{ "common.edit" | translate }}
              </button>
              <button
                (click)="deleteSkill(skill)"
                class="btn btn--outline btn--sm text-red-600 dark:text-red-400 text-xs sm:text-sm"
              >
                {{ "common.delete" | translate }}
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  } }

  <!-- Form Modal -->
  @if (showForm()) {
  <div
    class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-0 sm:p-4"
    role="button"
    tabindex="0"
    (click)="closeForm()"
    (keydown.enter)="closeForm()"
    (keydown.space)="closeForm()"
  >
    <div
      class="bg-white dark:bg-slate-800 p-4 sm:p-6 rounded-none sm:rounded-lg max-w-2xl w-full h-full sm:h-auto sm:max-h-[90vh] overflow-y-auto"
      role="button"
      tabindex="0"
      (click)="$event.stopPropagation()"
      (keydown.enter)="$event.stopPropagation()"
      (keydown.space)="$event.stopPropagation()"
    >
      <div
        class="flex justify-between items-center mb-4 sm:mb-6 sticky top-0 bg-white dark:bg-slate-800 pb-2 sm:pb-0 sm:static z-10"
      >
        <h3
          class="text-lg sm:text-2xl font-bold text-gray-900 dark:text-white pr-2"
        >
          {{
            editingSkill()
              ? ("common.edit" | translate)
              : ("common.create" | translate)
          }}
          {{ "nav.skills" | translate }}
        </h3>
        <button
          (click)="closeForm()"
          class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 flex-shrink-0"
        >
          <svg
            class="w-5 h-5 sm:w-6 sm:h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>

      <form
        [formGroup]="skillForm"
        (ngSubmit)="onSubmit()"
        class="space-y-3 sm:space-y-4"
      >
        <!-- Name -->
        <div class="form-group">
          <label for="name" class="form-label text-sm sm:text-base"
            >İsim *</label
          >
          <input
            id="name"
            type="text"
            formControlName="name"
            class="form-input text-sm sm:text-base"
            [class.border-red-500]="
              skillForm.get('name')?.invalid && skillForm.get('name')?.touched
            "
          />
          @if (skillForm.get('name')?.invalid && skillForm.get('name')?.touched)
          {
          <p class="form-error text-xs sm:text-sm">
            İsim zorunludur (min 2 karakter)
          </p>
          }
        </div>

        <!-- Category -->
        <div class="form-group">
          <label for="category" class="form-label text-sm sm:text-base"
            >Kategori *</label
          >
          <input
            id="category"
            type="text"
            formControlName="category"
            class="form-input text-sm sm:text-base"
            list="categories"
            [class.border-red-500]="
              skillForm.get('category')?.invalid &&
              skillForm.get('category')?.touched
            "
          />
          <datalist id="categories">
            @for (cat of getCategories(); track cat) {
            <option [value]="cat"></option>
            }
          </datalist>

          @if (skillForm.get('category')?.invalid &&
          skillForm.get('category')?.touched) {
          <p class="form-error text-xs sm:text-sm">Kategori zorunludur</p>
          }
        </div>

        <!-- Level -->
        <div class="form-group">
          <label for="level" class="form-label text-sm sm:text-base"
            >Seviye (1-100) *</label
          >
          <input
            id="level"
            type="number"
            formControlName="level"
            min="1"
            max="100"
            class="form-input text-sm sm:text-base"
            [class.border-red-500]="
              skillForm.get('level')?.invalid && skillForm.get('level')?.touched
            "
          />
          @if (skillForm.get('level')?.invalid &&
          skillForm.get('level')?.touched) {
          <p class="form-error text-xs sm:text-sm">
            Seviye 1-100 arası olmalıdır
          </p>
          }
        </div>

        <!-- Icon -->
        <div class="form-group">
          <label for="icon" class="form-label text-sm sm:text-base">Icon</label>
          <div class="flex flex-col sm:flex-row gap-2">
            <input
              id="icon"
              type="text"
              formControlName="icon"
              class="form-input flex-1 text-sm sm:text-base"
              placeholder="örn: simple-icons:github, logos:react, devicon:angular"
            />
            <button
              type="button"
              (click)="toggleIconPicker()"
              class="btn btn--outline text-sm sm:text-base w-full sm:w-auto"
            >
              {{ showIconPicker() ? "Kapat" : "Icon Seç" }}
            </button>
          </div>

          @if (skillForm.get('icon')?.value) {
          <div class="mt-2 flex items-center gap-2">
            <span class="text-sm text-gray-600 dark:text-gray-400"
              >Önizleme:</span
            >
            <app-skill-icon
              [iconName]="skillForm.get('icon')?.value"
              [size]="24"
            ></app-skill-icon>
            <span class="text-sm text-gray-500 dark:text-gray-500">{{
              skillForm.get("icon")?.value
            }}</span>
          </div>
          }

          <!-- Icon Picker -->
          @if (showIconPicker()) {
          <div
            class="mt-3 sm:mt-4 p-3 sm:p-4 border border-gray-200 dark:border-slate-700 rounded-lg bg-gray-50 dark:bg-slate-900 max-h-64 sm:max-h-96 overflow-y-auto"
          >
            <div class="mb-3 sm:mb-4">
              <input
                type="text"
                [ngModel]="iconSearchTerm()"
                (ngModelChange)="iconSearchTerm.set($event)"
                [ngModelOptions]="{ standalone: true }"
                placeholder="Icon ara..."
                class="form-input w-full text-sm sm:text-base"
                autocomplete="off"
              />
            </div>
            <div class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2">
              @for (icon of getFilteredIcons(); track icon) {
              <button
                type="button"
                (click)="selectIcon(icon)"
                class="p-2 border border-gray-200 dark:border-slate-700 rounded hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors flex flex-col items-center gap-1"
                [class.border-primary-500]="
                  skillForm.get('icon')?.value === icon
                "
                title="{{ icon }}"
              >
                <app-skill-icon
                  [iconName]="icon"
                  [size]="24"
                  color="currentColor"
                ></app-skill-icon>
                <span
                  class="text-xs text-gray-600 dark:text-gray-400 truncate w-full text-center"
                  >{{ getIconDisplayName(icon) }}</span
                >
              </button>
              }
            </div>
            @if (getFilteredIcons().length === 0) {
            <p class="text-center text-gray-500 dark:text-gray-400 py-4">
              Icon bulunamadı
            </p>
            }
          </div>
          }
        </div>

        <!-- Display Order -->
        <div class="form-group">
          <label for="displayOrder" class="form-label text-sm sm:text-base"
            >Görüntüleme Sırası</label
          >
          <input
            id="displayOrder"
            type="number"
            formControlName="displayOrder"
            class="form-input text-sm sm:text-base"
          />
        </div>

        <!-- Form Actions -->
        <div
          class="flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end pt-3 sm:pt-4 border-t border-gray-200 dark:border-gray-700"
        >
          <button
            type="button"
            (click)="closeForm()"
            class="btn btn--outline w-full sm:w-auto text-sm sm:text-base order-2 sm:order-1"
          >
            {{ "common.cancel" | translate }}
          </button>
          <button
            type="submit"
            [disabled]="skillForm.invalid || loading()"
            class="btn btn--primary w-full sm:w-auto text-sm sm:text-base order-1 sm:order-2"
          >
            {{
              editingSkill()
                ? ("common.update" | translate)
                : ("common.create" | translate)
            }}
          </button>
        </div>
      </form>
    </div>
  </div>
  }
</div>
